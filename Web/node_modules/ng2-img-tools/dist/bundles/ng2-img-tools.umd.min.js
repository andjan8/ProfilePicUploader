!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs"),require("ng2-img-max")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs","ng2-img-max"],r):r(e["ng2-img-tools"]={},e.ng.core,e.Rx,e.ng2ImgMax)}(this,function(e,r,t,n){"use strict";var i=function(){function e(e){this.ng2ImgMaxService=e}return e.prototype.cropImage=function(e,r,n,i,o){var a=this;void 0===i&&(i=0),void 0===o&&(o=0);var c=new t.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){c.error({croppedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),c.asObservable();var g=document.createElement("canvas"),s=g.getContext("2d"),u=new Image;return u.onload=function(){a.ng2ImgMaxService.getEXIFOrientedImage(u).then(function(t){window.URL.revokeObjectURL(u.src),g.width=r,g.height=n,s.drawImage(t,i,o,r,n,0,0,r,n);var p=s.getImageData(0,0,t.width,t.height),f=!0;("image/jpeg"===e.type||"image/png"===e.type&&!a.isImgUsingAlpha(p))&&(f=!1,(s=g.getContext("2d",{alpha:!1})).drawImage(t,i,o,r,n,0,0,r,n)),g.toBlob(function(r){var t=a.generateResultFile(r,e.name,e.type,(new Date).getTime());c.next(t)},f?"image/png":"image/jpeg")})},u.src=window.URL.createObjectURL(e),c.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var r=0;r<e.data.length;r+=4)if(255!==e.data[r+3])return!0;return!1},e.prototype.generateResultFile=function(e,r,t,n){var i=new Blob([e],{type:t});return this.blobToFile(i,r,n)},e.prototype.blobToFile=function(e,r,t){var n=e;return n.name=r,n.lastModified=t,n},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:n.Ng2ImgMaxService,decorators:[{type:r.Inject,args:[r.forwardRef(function(){return n.Ng2ImgMaxService})]}]}]},e}(),o=function(){function e(e,r){this.ng2ImgMaxService=e,this.imgCropService=r}return e.prototype.resizeExactFill=function(e,r,n,i){var o=this,a=new t.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){a.error({resizedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),a.asObservable();var c=new Image;return c.onload=function(){o.ng2ImgMaxService.getEXIFOrientedImage(c).then(function(t){window.URL.revokeObjectURL(c.src);var g=t.width/t.height,s=r/n,u=1e5,p=1e5;g>s?p=r:g<=s&&(u=n),o.ng2ImgMaxService.resize([e],p,u).subscribe(function(c){var g=0,s=0;if(1e5===p){var f=t.width/(t.height/n);g=(f-r)/2}else if(1e5===u){var m=t.height/(t.width/r);s=(m-n)/2}var d=new Image,v=document.createElement("canvas"),l=v.getContext("2d");d.onload=function(){v.width=r,v.height=n,i&&(l.fillStyle=i,l.fillRect(0,0,r,n)),l.drawImage(d,g,s,r,n,0,0,r,n);var t=l.getImageData(0,0,r,n),c=!0;("image/jpeg"===e.type||"image/png"===e.type&&!o.isImgUsingAlpha(t))&&(c=!1,l=v.getContext("2d",{alpha:!1}),i&&(l.fillStyle=i,l.fillRect(0,0,r,n)),l.drawImage(d,g,s,r,n,0,0,r,n)),v.toBlob(function(r){window.URL.revokeObjectURL(d.src);var t=o.generateResultFile(r,e.name,e.type,(new Date).getTime());a.next(t)},c?"image/png":"image/jpeg")},d.src=window.URL.createObjectURL(c)},function(e){a.error(e)})})},c.src=window.URL.createObjectURL(e),a.asObservable()},e.prototype.resizeExactCrop=function(e,r,n){var i=this,o=new t.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){o.error({resizedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),o.asObservable();var a=new Image;return a.onload=function(){i.ng2ImgMaxService.getEXIFOrientedImage(a).then(function(t){window.URL.revokeObjectURL(a.src);var c=t.width/t.height,g=r/n,s=1e5,u=1e5,p=0,f=0;c>g?s=n:c<=g&&(u=r),i.ng2ImgMaxService.resize([e],u,s).subscribe(function(e){if(1e5===u){var a=t.width/(t.height/n);p=(a-r)/2}else if(1e5===s){var c=t.height/(t.width/r);f=(c-n)/2}i.imgCropService.cropImage(e,r,n,p,f).subscribe(function(e){o.next(e)},function(e){o.error(e)})},function(e){o.error(e)})})},a.src=window.URL.createObjectURL(e),o.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var r=0;r<e.data.length;r+=4)if(255!==e.data[r+3])return!0;return!1},e.prototype.generateResultFile=function(e,r,t,n){var i=new Blob([e],{type:t});return this.blobToFile(i,r,n)},e.prototype.blobToFile=function(e,r,t){var n=e;return n.name=r,n.lastModified=t,n},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:n.Ng2ImgMaxService,decorators:[{type:r.Inject,args:[r.forwardRef(function(){return n.Ng2ImgMaxService})]}]},{type:i,decorators:[{type:r.Inject,args:[r.forwardRef(function(){return i})]}]}]},e}(),a=function(){function e(e,r,t){this.imgResizeExactService=e,this.ng2ImgMaxService=r,this.imgCropService=t}return e.prototype.compress=function(e,r,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compress(e,r,t,n)},e.prototype.resize=function(e,r,t,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resize(e,r,t,n)},e.prototype.crop=function(e,r,n,i,o){var a=this;void 0===i&&(i=0),void 0===o&&(o=0);var c=new t.Subject;return e.forEach(function(e){a.cropImage(e,r,n,i,o).subscribe(function(e){c.next(e)},function(e){c.error(e)})}),c.asObservable()},e.prototype.resizeExactCrop=function(e,r,n){var i=this,o=new t.Subject;return e.forEach(function(e){i.resizeExactCropImage(e,r,n).subscribe(function(e){o.next(e)},function(e){o.error(e)})}),o.asObservable()},e.prototype.resizeExactFill=function(e,r,n,i){var o=this,a=new t.Subject;return e.forEach(function(e){o.resizeExactFillImage(e,r,n,i).subscribe(function(e){a.next(e)},function(e){a.error(e)})}),a.asObservable()},e.prototype.resizeExactFillImage=function(e,r,t,n){return this.imgResizeExactService.resizeExactFill(e,r,t,n)},e.prototype.resizeExactCropImage=function(e,r,t){return this.imgResizeExactService.resizeExactCrop(e,r,t)},e.prototype.cropImage=function(e,r,t,n,i){return void 0===n&&(n=0),void 0===i&&(i=0),this.imgCropService.cropImage(e,r,t,n,i)},e.prototype.compressImage=function(e,r,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compressImage(e,r,t,n)},e.prototype.resizeImage=function(e,r,t,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resizeImage(e,r,t,n)},e.prototype.getEXIFOrientedImage=function(e){return this.ng2ImgMaxService.getEXIFOrientedImage(e)},e.decorators=[{type:r.Injectable}],e.ctorParameters=function(){return[{type:o,decorators:[{type:r.Inject,args:[r.forwardRef(function(){return o})]}]},{type:n.Ng2ImgMaxService,decorators:[{type:r.Inject,args:[r.forwardRef(function(){return n.Ng2ImgMaxService})]}]},{type:i,decorators:[{type:r.Inject,args:[r.forwardRef(function(){return i})]}]}]},e}(),c=function(){function e(){}return e.decorators=[{type:r.NgModule,args:[{imports:[n.Ng2ImgMaxModule],providers:[{provide:o,useClass:o},{provide:i,useClass:i},{provide:a,useClass:a},{provide:n.Ng2ImgMaxService,useClass:n.Ng2ImgMaxService}]}]}],e.ctorParameters=function(){return[]},e}();e.Ng2ImgToolsService=a,e.Ng2ImgToolsModule=c,e.ImgCropService=i,e.ImgResizeExactService=o,Object.defineProperty(e,"__esModule",{value:!0})});